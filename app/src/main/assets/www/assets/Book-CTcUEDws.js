import{r as c,j as e}from"./About-lZcx-U7f.js";function X(){const[l,t]=c.useState(null);return c.useEffect(()=>{const r=()=>{t(location.pathname)};return window.addEventListener("popstate",r),t(location.pathname),()=>window.removeEventListener("popstate",r)},[]),l}function V(l){window.history.pushState(null,"",l);const t=new PopStateEvent("popstate");window.dispatchEvent(t)}function P({href:l,onClick:t,className:r,children:n,...g}){return e.jsx("button",{props:g,onClick:async i=>{t&&await t()||V(l)},className:`cursor-pointer ${r}`,children:n})}const R=({audio:l,setIndex:t,txt:r,content:n,setUpdate:g})=>{const[i,u]=c.useState(null),d=c.useRef(null),f=c.useRef(null);let w;return r.length,c.useEffect(()=>{l&&(l.ontimeupdate=function(){let h;w=l.currentTime-r[0].time,h=r[r.length-1].time-r[0].time,u(w/h)})},[r,l]),e.jsx("div",{ref:f,className:"relative w-full h-full z-[100]",onClick:h=>{const v=h.currentTarget.getBoundingClientRect(),b=(h.pageX-v.left)/v.width;let j=r[r.length-1].time-r[0].time;l.currentTime=j*b+r[0].time;for(var p=0;p<r.length-1;p++)if(l.currentTime>r[p].time&&l.currentTime<r[p+1].time){t(p);break}u(b)},children:e.jsx("div",{ref:d,style:{left:`${i*100}%`},className:"absolute inset-y-0 flex place-items-center",children:e.jsx("div",{className:"animate-slowping border-l-[2px] border-solid border-red-600 h-[40%]"})})})};function H({setContent:l,currentChapter:t,setCurrentChapter:r,setIndex:n,texts:g,audio:i}){return e.jsx("div",{className:"fixed top-[10%] bottom-[4%] left-0 right-0 overflow-scroll z-40 backdrop-blur-lg bg-[linear-gradient(to_bottom_right,rgba(216,180,254,0.4),rgba(196,181,253,0.4),rgba(139,92,246,0.4))]",children:e.jsx("div",{className:"space-y-4 p-2",children:g.map((u,d)=>e.jsx("div",{className:`${t>=d?"text-slate-500":""}`,onClick:()=>{i.pause(),r(d),l(f=>!f),n(0)},children:u.index},d))})})}function I({setIsPaused:l,cover:t,texts:r,size:n,fontSize:g,currentChapter:i,setCurrentChapter:u,audioRef:d,index:f,setIndex:w}){return e.jsxs("div",{className:"fixed top-[10%] bottom-[4%] left-0 right-0 overflow-scroll z-40 bg-white bg-cover",style:{backgroundImage:`url(${URL.createObjectURL(t)})`},onClick:()=>{l(h=>(h?d.current.pause():d.current.play(),!h))},onTouchStart:h=>h.target.start=h.changedTouches[0].clientY,onTouchEnd:h=>{let v=h.target.start,b=h.changedTouches[0].clientY;b-v<-300&&r[i].texts[f+1]?(d.current.currentTime=r[i].texts[f+1].time,w(f+1)):b-v>300&&r[i].texts[f-1]&&(d.current.currentTime=r[i].texts[f-1].time,w(f-1))},children:[e.jsx("div",{className:"absolute bottom-0 w-full h-full bg-black/80 backdropBlur-md"}),e.jsx("div",{className:`${n[g]} text-white absolute h-full w-full px-4 flex place-items-center place-content-center`,children:r[i].texts[f].text})]})}function U({ctx:l}){const[t,r]=c.useState(0),[n,g]=c.useState(null),[i,u]=c.useState(0),[d,f]=c.useState(!1),[w,h]=c.useState(!1),[v,b]=c.useState(!1),[j,p]=c.useState(0),[T,M]=c.useState(1),[y,z]=c.useState(!0),[_,E]=c.useState(!1),[$,N]=c.useState(!1),x=c.useRef(null),C=["text-xl","text-2xl","text-3xl","text-4xl"];function L(o){let s=o.target,a=i,m=n[t],k=s.currentTime,S=!1;if(m.texts.find((B,A)=>m.texts[A+1]&&k>=B.time&&k<m.texts[A+1].time?(a=A,!0):(a=0,k>m.texts[m.texts.length-1].time&&(S=!0),!1)),S)switch(T){case 1:n[t+1]?(s.currentTime=n[t+1].texts[0].time,r(t+1),u(0)):s.pause();break;case 2:s.currentTime=n[t].texts[0].time,u(0);break;case 3:x.current.pause(),console.log("pause"),N(!1);break}else i!=a&&y&&u(a)}return c.useEffect(()=>{async function o(){let s=await l.db.get("blobs",l.book.id);l.audio=URL.createObjectURL(s.audio);let a=localStorage.getItem(l.book.id);a=a&&JSON.parse(a),a||(a={index:i,currentChapter:t,fontSize:j,player_status:T,indexMode:y},localStorage.setItem(l.book.id,JSON.stringify(a))),a&&(u(a.index),r(a.currentChapter),p(a.fontSize),z(a.indexMode),M(a.player_status)),g(s.text)}o()},[]),c.useEffect(()=>{if(!n)return;let o=document.getElementById(i);o&&o.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"});let s=localStorage.getItem(l.book.id);s=JSON.parse(s),s.index=i,s.currentChapter=t,s.fontSize=j,s.indexMode=y,s.player_status=T,localStorage.setItem(l.book.id,JSON.stringify(s))},[i,w,n]),c.useEffect(()=>{_&&(x.current.currentTime=n[t].texts[i].time,x.current.play(),N(!0))},[_]),n?e.jsxs("div",{className:"fixed inset-0 overflow-scroll",onTouchStart:()=>{if(d||y)return;let o=x.current.currentTime;for(let s=t;s<n.length;s++){const a=n[s];if(a.texts.find((k,S)=>{if(a.texts[S+1]&&o>=k.time&&o<a.texts[S+1].time)return s!=t&&r(s),u(S),k}))break}},children:[e.jsxs("header",{className:"z-50 backdrop-blur-md flex space-x-2 px-2 place-items-center justify-around fixed top-0 w-full h-[10%] bg-purple-500/30",onTouchStart:o=>o.target.start=o.changedTouches[0].clientX,onTouchEnd:o=>{let s=o.target.start,a=o.changedTouches[0].clientX;a-s>200?h(m=>!m):a-s<-200&&h(m=>!m)},children:[e.jsx(P,{href:"/",children:e.jsx("div",{className:`w-13 pb-13 bg-cover rounded-full border-1 border-white ${$?"slow-spin":""}`,style:{backgroundImage:`url(${URL.createObjectURL(l.book.cover)})`}})}),e.jsx("h1",{className:`text-sm italic text-center ${$?"slide-fade":""}`,children:l.book.title}),e.jsxs("div",{className:"relative",onClick:()=>f(o=>!o),children:[e.jsx("div",{className:"z-10 absolute right-[-20%] top-[-15%] w-6 h-6 text-sm rounded-full bg-purple-700 flex items-center justify-center text-white",children:t+1}),e.jsxs("div",{className:"relative w-9 h-9 z-0",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`icon-transition w-9 h-9 ${d?"icon-visible":"icon-hidden"}`,fill:"currentColor",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"})}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",className:`icon-transition w-9 h-9 ${d?"icon-hidden":"icon-visible"}`,viewBox:"0 0 16 16",children:e.jsx("path",{fillRule:"evenodd",d:"M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2"})})]})]})]}),e.jsx("audio",{ref:x,src:l.audio,onTimeUpdate:L,onCanPlay:()=>E(!0)}),d?e.jsx(H,{setContent:f,currentChapter:t,setCurrentChapter:r,setIndex:u,texts:n,audio:x.current}):"",w?e.jsx(I,{cover:l.book.cover,size:C,setIsPaused:N,fontSize:j,texts:n,currentChapter:t,setCurrentChapter:r,audioRef:x,index:i,setIndex:u}):e.jsxs("main",{className:`space-y-4 p-2 px-4 mt-[15%] ${C[j]} ${d?"overflow-hidden":""}`,children:[e.jsx("button",{className:`${n[t-1]?"":"hidden"} my-10 flex mx-auto px-8 py-4 text-xl rounded-full bg-sky-400`,onClick:()=>{x.current.currentTime=n[t-1].texts[0].time,r(t-1),u(0)},children:"Previous"}),e.jsx("div",{className:`${n[t-1]?"mt-5":""}`}),n&&n[t].texts.map((o,s)=>e.jsx("div",{id:s,className:`${i==s?"font-bold text-sky-500":""}`,onClick:()=>{s==i?N(a=>(a?x.current.pause():x.current.play(),!a)):(x.current.currentTime=n[t].texts[s].time,u(s))},children:o.text},s)),e.jsx("div",{className:`${n[t+1]?"":"mb-10"}`}),e.jsx("button",{className:`${n[t+1]?"":"hidden"} flex mx-auto my-10 px-8 py-4 text-xl rounded-full bg-sky-400`,onClick:()=>{x.current.currentTime=n[t+1].texts[0].time,r(t+1),u(0)},children:"Next"})]}),e.jsxs("footer",{className:"z-50 backdrop-blur-md flex space-x-2 px-2 place-items-center justify-around fixed bottom-0 w-full h-[5%] bg-purple-500/30",onTouchStart:o=>{o.target.start=o.changedTouches[0].clientX},onTouchEnd:o=>{let s=o.target.start,a=o.changedTouches[0].clientX;a-s>200?p(m=>m==C.length-1?0:m+1):a-s<-200&&p(m=>m==0?m:m-1)},children:[e.jsx("div",{className:"text-sky-500",onClick:()=>M(o=>o==3?1:o+1),children:T==1?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M11 5.466V4H5a4 4 0 0 0-3.584 5.777.5.5 0 1 1-.896.446A5 5 0 0 1 5 3h6V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192m3.81.086a.5.5 0 0 1 .67.225A5 5 0 0 1 11 13H5v1.466a.25.25 0 0 1-.41.192l-2.36-1.966a.25.25 0 0 1 0-.384l2.36-1.966a.25.25 0 0 1 .41.192V12h6a4 4 0 0 0 3.585-5.777.5.5 0 0 1 .225-.67Z"})}):T==2?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:[e.jsx("path",{d:"M11 4v1.466a.25.25 0 0 0 .41.192l2.36-1.966a.25.25 0 0 0 0-.384l-2.36-1.966a.25.25 0 0 0-.41.192V3H5a5 5 0 0 0-4.48 7.223.5.5 0 0 0 .896-.446A4 4 0 0 1 5 4zm4.48 1.777a.5.5 0 0 0-.896.446A4 4 0 0 1 11 12H5.001v-1.466a.25.25 0 0 0-.41-.192l-2.36 1.966a.25.25 0 0 0 0 .384l2.36 1.966a.25.25 0 0 0 .41-.192V13h6a5 5 0 0 0 4.48-7.223Z"}),e.jsx("path",{d:"M9 5.5a.5.5 0 0 0-.854-.354l-1.75 1.75a.5.5 0 1 0 .708.708L8 6.707V10.5a.5.5 0 0 0 1 0z"})]}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:[e.jsx("path",{d:"M11 5.466V4H5a4 4 0 0 0-3.584 5.777.5.5 0 1 1-.896.446A5 5 0 0 1 5 3h6V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192m3.81.086a.5.5 0 0 1 .67.225A5 5 0 0 1 11 13H5v1.466a.25.25 0 0 1-.41.192l-2.36-1.966a.25.25 0 0 1 0-.384l2.36-1.966a.25.25 0 0 1 .41.192V12h6a4 4 0 0 0 3.585-5.777.5.5 0 0 1 .225-.67Z"}),e.jsx("line",{x1:"2",y1:"2",x2:"14",y2:"14",stroke:"currentColor",strokeWidth:"1.5"})]})}),e.jsx(R,{audio:x.current,setIndex:u,txt:n[t].texts,content:d,setUpdate:b}),e.jsx("div",{className:"text-sky-400",onClick:()=>z(!y),children:y?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:[e.jsx("path",{d:"M2 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2M0 2a2 2 0 0 1 3.937-.5h8.126A2 2 0 1 1 14.5 3.937v8.126a2 2 0 1 1-2.437 2.437H3.937A2 2 0 1 1 1.5 12.063V3.937A2 2 0 0 1 0 2m2.5 1.937v8.126c.703.18 1.256.734 1.437 1.437h8.126a2 2 0 0 1 1.437-1.437V3.937A2 2 0 0 1 12.063 2.5H3.937A2 2 0 0 1 2.5 3.937M14 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2M2 13a1 1 0 1 0 0 2 1 1 0 0 0 0-2m12 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2"}),e.jsx("text",{x:"8",y:"11",textAnchor:"middle",fontSize:"10",fill:"currentColor",fontFamily:"Arial, sans-serif",children:"A"})]}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:[e.jsx("path",{d:"M2 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2M0 2a2 2 0 0 1 3.937-.5h8.126A2 2 0 1 1 14.5 3.937v8.126a2 2 0 1 1-2.437 2.437H3.937A2 2 0 1 1 1.5 12.063V3.937A2 2 0 0 1 0 2m2.5 1.937v8.126c.703.18 1.256.734 1.437 1.437h8.126a2 2 0 0 1 1.437-1.437V3.937A2 2 0 0 1 12.063 2.5H3.937A2 2 0 0 1 2.5 3.937M14 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2M2 13a1 1 0 1 0 0 2 1 1 0 0 0 0-2m12 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2"}),e.jsx("text",{x:"8",y:"11",textAnchor:"middle",fontSize:"10",fontFamily:"Arial",fill:"currentColor",children:"M"})]})})]})]}):e.jsx("div",{children:"loading...."})}const J=Object.freeze(Object.defineProperty({__proto__:null,default:U},Symbol.toStringTag,{value:"Module"}));export{J as B,P as L,V as n,X as u};
