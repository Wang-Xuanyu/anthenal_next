import{r as c,j as e}from"./About-dplKy6fd.js";function O(){const[s,t]=c.useState(null);return c.useEffect(()=>{const n=()=>{t(location.pathname)};return window.addEventListener("popstate",n),t(location.pathname),()=>window.removeEventListener("popstate",n)},[]),s}function z(s){window.history.pushState(null,"",s);const t=new PopStateEvent("popstate");window.dispatchEvent(t)}function B({href:s,onClick:t,className:n,children:l,...w}){return e.jsx("button",{props:w,onClick:async o=>{t&&await t()||z(s)},className:`cursor-pointer ${n}`,children:l})}const Z=({audio:s,setIndex:t,txt:n,content:l,setIsPaused:w})=>{const[o,d]=c.useState(null),f=c.useRef(null),h=c.useRef(null);let x;return n.length,c.useEffect(()=>{s&&(s.ontimeupdate=function(){let u;x=s.currentTime-n[0].time,u=n[n.length-1].time-n[0].time,d(x/u)})},[n,s]),e.jsx("div",{ref:h,className:"relative w-full h-full z-[100]",onClick:u=>{const p=u.currentTarget.getBoundingClientRect(),C=(u.pageX-p.left)/p.width;let j=n[n.length-1].time-n[0].time;s.currentTime=j*C+n[0].time;for(var v=0;v<n.length-1;v++)if(s.currentTime>n[v].time&&s.currentTime<n[v+1].time){t(v);break}s.paused&&(w(b=>!b),s.play()),d(C)},children:e.jsx("div",{ref:f,style:{left:`${o*100}%`},className:"absolute inset-y-0 flex place-items-center",children:e.jsx("div",{className:"animate-slowping border-l-[2px] border-solid border-red-600 h-[40%]"})})})};function V({size:s,fontSize:t,setContent:n,currentChapter:l,setCurrentChapter:w,setIndex:o,texts:d,audio:f}){return c.useEffect(()=>{let h=document.getElementById(`chapter${l}`);h&&h.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},[]),e.jsx("div",{className:"fixed top-[10%] bottom-[4%] left-0 right-0 overflow-scroll z-40 backdrop-blur-lg bg-[linear-gradient(to_bottom_right,rgba(216,180,254,0.4),rgba(196,181,253,0.4),rgba(139,92,246,0.4))]",children:e.jsx("div",{className:"space-y-6 p-2 px-4",children:d.map((h,x)=>e.jsxs("div",{id:"chapter"+x,className:`flex place-items-center space-x-4 ${l>x?"text-slate-500":l==x?"text-red-600":""} ${s[t]}`,onClick:()=>{f.currentTime=d[x].texts[0].time,w(x),n(u=>!u),o(0)},children:[e.jsx("span",{children:h.index}),l==x?e.jsx("span",{className:"animate-bounce",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`text-red-600 ${s[t]}`,width:"20",height:"20",fill:"currentColor",viewBox:"0 0 16 16",children:e.jsx("path",{"fill-rule":"evenodd",d:"M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8"})})}):""]},x))})})}function H({setIsPaused:s,cover:t,texts:n,size:l,fontSize:w,currentChapter:o,setCurrentChapter:d,audioRef:f,index:h,setIndex:x}){return e.jsxs("div",{className:"fixed top-[10%] bottom-[4%] left-0 right-0 overflow-scroll z-40 bg-white bg-cover",style:{backgroundImage:`url(${URL.createObjectURL(t)})`},onClick:()=>{s(u=>(u?f.current.pause():f.current.play(),!u))},onTouchStart:u=>u.target.start=u.changedTouches[0].clientY,onTouchEnd:u=>{let p=u.target.start,C=u.changedTouches[0].clientY;C-p<-300&&n[o].texts[h+1]?(f.current.currentTime=n[o].texts[h+1].time,x(h+1)):C-p>300&&n[o].texts[h-1]&&(f.current.currentTime=n[o].texts[h-1].time,x(h-1))},children:[e.jsx("div",{className:"absolute bottom-0 w-full h-full bg-black/80 backdropBlur-md"}),e.jsx("div",{className:`${l[w]} text-white absolute h-full w-full px-4 flex place-items-center place-content-center`,children:n[o].texts[h].text})]})}function P({color:s}){return s||(s="#8372FF"),e.jsx("div",{className:"flex h-[100vh] justify-center items-center bg-transparent",children:e.jsx("svg",{width:"40",height:"38",viewBox:"0 0 40 40",version:"1.1",children:e.jsx("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd",children:e.jsx("g",{transform:"translate(-880.000000, -505.000000)",fill:s,fillRule:"nonzero",children:e.jsx("g",{transform:"translate(880.000000, 504.000000)",children:e.jsx("g",{transform:"translate(0.000000, 1.000000)",children:e.jsx("path",{d:"M34,28.6042217 C34,28.7519789 34.1,28.8504837 34.25,28.8504837 C34.4,28.8504837 34.5,28.7519789 34.5,28.6042217 C34.5,28.4564644 34.4,28.3579596 34.25,28.3579596 C34.1,28.3579596 34,28.4564644 34,28.6042217 Z M28.6,34.0712401 C28.6,34.3175022 28.8,34.5637643 29.1,34.5637643 C29.35,34.5637643 29.6,34.3667546 29.6,34.0712401 C29.6,33.824978 29.4,33.5787159 29.1,33.5787159 C28.85,33.6279683 28.6,33.824978 28.6,34.0712401 Z M21.35,36.9278804 C21.35,37.3218997 21.7,37.6666667 22.1,37.6666667 C22.5,37.6666667 22.85,37.3218997 22.85,36.9278804 C22.85,36.5338611 22.5,36.1890941 22.1,36.1890941 C21.7,36.1890941 21.35,36.5338611 21.35,36.9278804 Z M13.55,36.533861 C13.55,37.0756376 14,37.469657 14.5,37.469657 C15,37.469657 15.45,37.0263852 15.45,36.533861 C15.45,35.9920844 15,35.5980651 14.5,35.5980651 C14,35.5980651 13.55,35.9920844 13.55,36.533861 Z M6.60000001,33.0369393 C6.60000001,33.6772208 7.15000003,34.2189974 7.80000001,34.2189974 C8.44999999,34.2189974 9.00000001,33.6772208 9.00000001,33.0369393 C9.00000001,32.3966579 8.44999999,31.8548813 7.80000001,31.8548813 C7.15000003,31.8056289 6.60000001,32.3474054 6.60000001,33.0369393 Z M1.79999999,27.0281442 C1.79999999,27.8161829 2.44999998,28.4564644 3.24999999,28.4564644 C4.05,28.4564644 4.70000001,27.8161829 4.70000001,27.0281442 C4.70000001,26.2401055 4.05000003,25.5998241 3.24999999,25.5998241 C2.44999998,25.5998241 1.79999999,26.2401055 1.79999999,27.0281442 Z M0,19.7387863 C0,20.6745822 0.749999988,21.4133685 1.69999999,21.4133685 C2.64999999,21.4133685 3.40000001,20.6745822 3.40000001,19.7387863 C3.40000001,18.8029903 2.65000003,18.0642041 1.69999999,18.0642041 C0.749999988,18.0149517 0,18.8029903 0,19.7387863 Z M1.50000001,12.4494283 C1.50000001,13.5329815 2.35000001,14.3702726 3.45,14.3702726 C4.50000001,14.3702726 5.39999998,13.5329815 5.39999998,12.4494283 C5.39999998,11.3658751 4.54999999,10.528584 3.45,10.528584 C2.35000001,10.528584 1.50000001,11.3658751 1.50000001,12.4494283 Z M5.95,6.53913808 C5.95,7.72119613 6.95,8.70624452 8.15000001,8.70624452 C9.35000001,8.70624452 10.35,7.72119616 10.35,6.53913808 C10.35,5.35708004 9.35000001,4.37203168 8.15000001,4.37203168 C6.9,4.37203168 5.95,5.35708004 5.95,6.53913808 Z M12.45,3.1899736 C12.45,4.51978889 13.55,5.60334213 14.9,5.60334213 C16.25,5.60334213 17.35,4.51978893 17.35,3.1899736 C17.35,1.86015827 16.25,0.776605109 14.9,0.776605109 C13.55,0.776605109 12.45,1.86015831 12.45,3.1899736 Z M19.8,2.99296395 C19.8,4.47053652 21,5.65259453 22.45,5.65259453 C23.95,5.65259453 25.1,4.47053649 25.1,2.99296395 C25.1,1.51539138 23.9,0.333333333 22.45,0.333333333 C21,0.333333333 19.8,1.51539138 19.8,2.99296395 Z M26.5,5.94810906 C26.5,7.52418644 27.8,8.80474933 29.4,8.80474933 C31,8.80474933 32.3,7.52418644 32.3,5.94810906 C32.3,4.37203168 31,3.09146879 29.4,3.09146879 C27.85,3.09146879 26.5,4.37203168 26.5,5.94810906 Z M31.3,11.5628848 C31.3,13.2867194 32.7,14.6657872 34.45,14.6657872 C36.2,14.6657872 37.6,13.2867194 37.6,11.5628848 C37.6,9.83905012 36.2,8.45998239 34.45,8.45998239 C32.7,8.45998239 31.3,9.83905012 31.3,11.5628848 L31.3,11.5628848 Z M33.3333333,19.6666667 C33.3333333,21.5294118 34.8039216,23 36.6666666,23 C38.5294117,23 40,21.4803922 40,19.6666667 C40,17.8039216 38.5294117,16.3333333 36.6666666,16.3333333 C34.8039215,16.3333333 33.3333333,17.8529412 33.3333333,19.6666667 L33.3333333,19.6666667 Z",children:e.jsx("animateTransform",{attributeType:"xml",attributeName:"transform",type:"rotate",from:"0 20 20",to:"360 20 20",dur:"2s",repeatCount:"indefinite"})})})})})})})})}function R({ctx:s}){const[t,n]=c.useState(0),[l,w]=c.useState(null),[o,d]=c.useState(0),[f,h]=c.useState(!1),[x,u]=c.useState(!1),[p,C]=c.useState(0),[j,v]=c.useState(1),[b,S]=c.useState(!0),[A,E]=c.useState(!1),[$,N]=c.useState(!1),g=c.useRef(null),T=["text-xl","text-2xl","text-3xl","text-4xl"];function L(i){let r=i.target,a=o,m=l[t],y=r.currentTime,k=!1;if(m.texts.find((_,M)=>m.texts[M+1]&&y>=_.time&&y<m.texts[M+1].time?(a=M,!0):(a=0,y>m.texts[m.texts.length-1].time&&(k=!0),!1)),k)switch(j){case 1:l[t+1]?(r.currentTime=l[t+1].texts[0].time,n(t+1),d(0)):r.pause();break;case 2:r.currentTime=l[t].texts[0].time,d(0);break;case 3:g.current.pause(),console.log("pause"),N(!1);break}else o!=a&&b&&d(a)}return c.useEffect(()=>{async function i(){let r=await s.db.get("blobs",s.book.id);s.audio=URL.createObjectURL(r.audio);let a=localStorage.getItem(s.book.id);a=a&&JSON.parse(a),a||(a={index:o,currentChapter:t,fontSize:p,player_status:j,indexMode:b},localStorage.setItem(s.book.id,JSON.stringify(a))),a&&(d(a.index),n(a.currentChapter),C(a.fontSize),S(a.indexMode),v(a.player_status)),w(r.text)}i()},[]),c.useEffect(()=>{if(!l)return;let i=document.getElementById(o);i&&i.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"});let r=localStorage.getItem(s.book.id);r=JSON.parse(r),r.index=o,r.currentChapter=t,r.fontSize=p,r.indexMode=b,r.player_status=j,localStorage.setItem(s.book.id,JSON.stringify(r))},[o,x,l]),c.useEffect(()=>{A&&(g.current.currentTime=l[t].texts[o].time,g.current.play(),N(!0))},[A]),l?e.jsxs("div",{className:"fixed inset-0 overflow-scroll",onTouchStart:()=>{if(f||b)return;let i=g.current.currentTime;for(let r=t;r<l.length;r++){const a=l[r];if(a.texts.find((y,k)=>{if(a.texts[k+1]&&i>=y.time&&i<a.texts[k+1].time)return r!=t&&n(r),d(k),y}))break}},children:[e.jsxs("header",{className:"z-50 backdrop-blur-md flex space-x-2 px-2 place-items-center justify-around fixed top-0 w-full h-[10%] bg-purple-500/30",onTouchStart:i=>i.target.start=i.changedTouches[0].clientX,onTouchEnd:i=>{let r=i.target.start,a=i.changedTouches[0].clientX;a-r>200?u(m=>!m):a-r<-200&&u(m=>!m)},children:[e.jsx(B,{href:"/",children:e.jsx("div",{className:`w-13 pb-13 bg-cover rounded-full border-1 border-white ${$?"slow-spin":""}`,style:{backgroundImage:`url(${URL.createObjectURL(s.book.cover)})`}})}),e.jsx("h1",{className:`text-sm italic text-center ${$?"slide-fade":""}`,children:s.book.title}),e.jsxs("div",{className:"relative",onClick:()=>h(i=>!i),children:[e.jsx("div",{className:"z-10 absolute right-[-20%] top-[-15%] w-6 h-6 text-sm rounded-full bg-purple-700 flex items-center justify-center text-white",children:t+1}),e.jsxs("div",{className:"relative w-9 h-9 z-0",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`icon-transition w-9 h-9 ${f?"icon-visible":"icon-hidden"}`,fill:"currentColor",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"})}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",className:`icon-transition w-9 h-9 ${f?"icon-hidden":"icon-visible"}`,viewBox:"0 0 16 16",children:e.jsx("path",{fillRule:"evenodd",d:"M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5m-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2m0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2"})})]})]})]}),e.jsx("audio",{ref:g,src:s.audio,onTimeUpdate:L,onCanPlay:()=>E(!0)}),f?e.jsx(V,{size:T,fontSize:p,setContent:h,currentChapter:t,setCurrentChapter:n,setIndex:d,texts:l,audio:g.current}):"",x?e.jsx(H,{cover:s.book.cover,size:T,setIsPaused:N,fontSize:p,texts:l,currentChapter:t,setCurrentChapter:n,audioRef:g,index:o,setIndex:d}):e.jsxs("main",{className:`space-y-4 p-2 px-4 mt-[15%] ${T[p]} ${f?"overflow-hidden":""}`,children:[e.jsx("button",{className:`${l[t-1]?"":"hidden"} my-10 flex mx-auto px-8 py-4 text-xl rounded-full bg-sky-400`,onClick:()=>{g.current.currentTime=l[t-1].texts[0].time,n(t-1),d(0)},children:"Previous"}),e.jsx("div",{className:`${l[t-1]?"mt-5":""}`}),l&&l[t].texts.map((i,r)=>e.jsx("div",{id:r,className:`${o==r?"font-bold text-sky-500":""}`,onClick:()=>{r==o?N(a=>(a?g.current.pause():g.current.play(),!a)):(g.current.currentTime=l[t].texts[r].time,d(r))},children:i.text},r)),e.jsx("div",{className:`${l[t+1]?"":"mb-10"}`}),e.jsx("button",{className:`${l[t+1]?"":"hidden"} flex mx-auto my-10 px-8 py-4 text-xl rounded-full bg-sky-400`,onClick:()=>{g.current.currentTime=l[t+1].texts[0].time,n(t+1),d(0)},children:"Next"})]}),e.jsxs("footer",{className:"z-50 backdrop-blur-md flex space-x-2 px-2 place-items-center justify-around fixed bottom-0 w-full h-[5%] bg-purple-500/30",onTouchStart:i=>{i.target.start=i.changedTouches[0].clientX},onTouchEnd:i=>{let r=i.target.start,a=i.changedTouches[0].clientX;a-r>200?C(m=>m==T.length-1?0:m+1):a-r<-200&&C(m=>m==0?m:m-1)},children:[e.jsx("div",{className:"text-sky-500",onClick:()=>v(i=>i==3?1:i+1),children:j==1?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M11 5.466V4H5a4 4 0 0 0-3.584 5.777.5.5 0 1 1-.896.446A5 5 0 0 1 5 3h6V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192m3.81.086a.5.5 0 0 1 .67.225A5 5 0 0 1 11 13H5v1.466a.25.25 0 0 1-.41.192l-2.36-1.966a.25.25 0 0 1 0-.384l2.36-1.966a.25.25 0 0 1 .41.192V12h6a4 4 0 0 0 3.585-5.777.5.5 0 0 1 .225-.67Z"})}):j==2?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:[e.jsx("path",{d:"M11 4v1.466a.25.25 0 0 0 .41.192l2.36-1.966a.25.25 0 0 0 0-.384l-2.36-1.966a.25.25 0 0 0-.41.192V3H5a5 5 0 0 0-4.48 7.223.5.5 0 0 0 .896-.446A4 4 0 0 1 5 4zm4.48 1.777a.5.5 0 0 0-.896.446A4 4 0 0 1 11 12H5.001v-1.466a.25.25 0 0 0-.41-.192l-2.36 1.966a.25.25 0 0 0 0 .384l2.36 1.966a.25.25 0 0 0 .41-.192V13h6a5 5 0 0 0 4.48-7.223Z"}),e.jsx("path",{d:"M9 5.5a.5.5 0 0 0-.854-.354l-1.75 1.75a.5.5 0 1 0 .708.708L8 6.707V10.5a.5.5 0 0 0 1 0z"})]}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:[e.jsx("path",{d:"M11 5.466V4H5a4 4 0 0 0-3.584 5.777.5.5 0 1 1-.896.446A5 5 0 0 1 5 3h6V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192m3.81.086a.5.5 0 0 1 .67.225A5 5 0 0 1 11 13H5v1.466a.25.25 0 0 1-.41.192l-2.36-1.966a.25.25 0 0 1 0-.384l2.36-1.966a.25.25 0 0 1 .41.192V12h6a4 4 0 0 0 3.585-5.777.5.5 0 0 1 .225-.67Z"}),e.jsx("line",{x1:"2",y1:"2",x2:"14",y2:"14",stroke:"currentColor",strokeWidth:"1.5"})]})}),e.jsx(Z,{audio:g.current,setIndex:d,txt:l[t].texts,content:f,setIsPaused:N}),e.jsx("div",{className:"text-sky-400",onClick:()=>S(!b),children:b?e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:[e.jsx("path",{d:"M2 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2M0 2a2 2 0 0 1 3.937-.5h8.126A2 2 0 1 1 14.5 3.937v8.126a2 2 0 1 1-2.437 2.437H3.937A2 2 0 1 1 1.5 12.063V3.937A2 2 0 0 1 0 2m2.5 1.937v8.126c.703.18 1.256.734 1.437 1.437h8.126a2 2 0 0 1 1.437-1.437V3.937A2 2 0 0 1 12.063 2.5H3.937A2 2 0 0 1 2.5 3.937M14 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2M2 13a1 1 0 1 0 0 2 1 1 0 0 0 0-2m12 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2"}),e.jsx("text",{x:"8",y:"11",textAnchor:"middle",fontSize:"10",fill:"currentColor",fontFamily:"Arial, sans-serif",children:"A"})]}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:[e.jsx("path",{d:"M2 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2M0 2a2 2 0 0 1 3.937-.5h8.126A2 2 0 1 1 14.5 3.937v8.126a2 2 0 1 1-2.437 2.437H3.937A2 2 0 1 1 1.5 12.063V3.937A2 2 0 0 1 0 2m2.5 1.937v8.126c.703.18 1.256.734 1.437 1.437h8.126a2 2 0 0 1 1.437-1.437V3.937A2 2 0 0 1 12.063 2.5H3.937A2 2 0 0 1 2.5 3.937M14 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2M2 13a1 1 0 1 0 0 2 1 1 0 0 0 0-2m12 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2"}),e.jsx("text",{x:"8",y:"11",textAnchor:"middle",fontSize:"10",fontFamily:"Arial",fill:"currentColor",children:"M"})]})})]})]}):e.jsx(P,{})}const U=Object.freeze(Object.defineProperty({__proto__:null,default:R},Symbol.toStringTag,{value:"Module"}));export{U as B,P as H,B as L,z as n,O as u};
